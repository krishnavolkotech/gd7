<?php

/**
 * @file
 */

/**
 * Implements hook_user_cancel().
 */

/**
 *
 */
function inactive_user_user_cancel($edit, $account, $method) {
  \Drupal::database()->delete('inactive_users')
    ->condition('uid', $account->uid)
    ->execute();
}

/**
 * Implements hook_mail().
 */

/**
 * Function inactive_user_mail($key, &$message, $params) {.
 */
function inactive_user_mail($key, &$message, $params) {
  $message['subject'] = $params['subject'];
  $message['body'][] = $params['message'];
}

/**
 * Implements hook_schema().
 *
 * @todo remove this as this is already declared in inactive.install file
 *
 */
/*function inactive_user_schema() {
  $schema['inactive_users'] = array(
    'description' => 'The base table for inactive_users.',
    'fields' => array(
      'uid' => array(
        'description' => 'The primary identifier for a user.',
        'type' => 'int',
        'unsigned' => TRUE,
        'not null' => TRUE,
        'default' => 0,
      ),
      'notified_admin' => array(
        'description' => 'Admin notifier.',
        'type' => 'int',
        'size' => 'tiny',
        'unsigned' => TRUE,
        'not null' => TRUE,
        'default' => 0,
      ),
      'notified_user' => array(
        'description' => 'User notifier.',
        'type' => 'int',
        'size' => 'tiny',
        'unsigned' => TRUE,
        'not null' => TRUE,
        'default' => 0,
      ),
      'warned_user_block_timestamp' => array(
        'description' => 'Timestamp warning.',
        'type' => 'int',
        'unsigned' => TRUE,
        'not null' => TRUE,
        'default' => 0,
      ),
      'notified_user_block' => array(
        'description' => 'User block warning.',
        'type' => 'int',
        'size' => 'tiny',
        'unsigned' => TRUE,
        'not null' => TRUE,
        'default' => 0,
      ),
      'notified_admin_block' => array(
        'description' => 'Timestamp warning.',
        'type' => 'int',
        'size' => 'tiny',
        'unsigned' => TRUE,
        'not null' => TRUE,
        'default' => 0,
      ),
      'warned_user_delete_timestamp' => array(
        'description' => 'Timestamp warning.',
        'type' => 'int',
        'unsigned' => TRUE,
        'not null' => TRUE,
        'default' => 0,
      ),
      'protected' => array(
        'description' => 'Timestamp warning.',
        'type' => 'int',
        'size' => 'tiny',
        'unsigned' => TRUE,
        'not null' => TRUE,
        'default' => 0,
      ),
      'inactive_user_notification_flag' => array(
        'description' => 'Inactive user notification flag.',
        'type' => 'int',
        'not null' => TRUE,
        'default' => 1,
      ),
    ),
    'primary key' => array('uid'),
  );
  return $schema;
}*/

/**
 * Returns 1 if the user has ever created a node or a comment.
 *
 * The settings of inactive_user.module allow to protect such
 * users from deletion.
 */
function _inactive_user_with_content($uid) {

  $query = \Drupal::database()->select('node_field_data', 'nfd');
  $query->addField('nfd', 'uid');
  $query->condition('nfd.uid', $uid, '=');
  $node_field_data_uid = $query->execute()->fetchField();

  $query = \Drupal::database()->select('comment_field_data', 'cfd');
  $query->addField('cfd', 'uid');
  $query->condition('nfd.uid', $uid, '=');
  $comment_field_data_uid = $query->execute()->fetchField();

  return ($node_field_data_uid || $comment_field_data_uid);

}
